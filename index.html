<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Iframe por elemento</title>
    <script src="https://cdn.jsdelivr.net/npm/monday-sdk-js/dist/monday-sdk.min.js"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      #mensaje {
        font-family: sans-serif;
        padding: 20px;
        color: #444;
      }
    </style>
  </head>
  <body>
    <div id="mensaje">Cargando...</div>
    <iframe id="iframe" style="display: none;"></iframe>

    <script>
      const monday = window.mondaySdk();
      const iframe = document.getElementById("iframe");
      const mensaje = document.getElementById("mensaje");

      // Mostrar paso a paso lo que est√° pasando
      function logAndShow(msg, data = null) {
        console.log(msg, data);
        mensaje.innerText = msg;
      }

      monday.listen("context", async (res) => {
        const itemId = res.data?.itemId;
        const boardId = res.data?.boardId;

        if (!itemId || !boardId) {
          logAndShow("‚ùå No se pudo obtener el itemId o boardId.", res.data);
          return;
        }

        logAndShow(`üì¶ Obteniendo URL del √≠tem ${itemId} del board ${boardId}...`);

        try {
          const response = await monday.api(`
            query {
              items(ids: ${itemId}) {
                column_values(ids: ["text_mknys7ye"]) {
                  id
                  text
                }
              }
            }
          `);

          console.log("üßæ Respuesta de monday.api:", response);

          const columnValues = response.data?.items?.[0]?.column_values;
          if (!columnValues || columnValues.length === 0) {
            logAndShow("‚ö†Ô∏è No se encontr√≥ la columna con ID 'text_mknys7ye'.");
            return;
          }

          const url = columnValues[0]?.text;

          if (url) {
            logAndShow(`‚úÖ Mostrando iframe para: ${url}`);
            iframe.src = url;
            iframe.style.display = "block";
            mensaje.style.display = "none";
          } else {
            logAndShow("‚ö†Ô∏è La columna est√° vac√≠a o no tiene una URL.");
          }
        } catch (error) {
          console.error("‚ùå Error al consultar monday.api:", error);
          logAndShow("‚ùå Hubo un error al obtener los datos del √≠tem.");
        }
      });
    </script>
  </body>
</html>
